<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãªã”ã¿ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ</title>
  <style>
    body {
      font-family: sans-serif;
      background: #eaf8fc;
      margin: 0;
      padding: 1em;
      color: #333;
    }
    h2 {
      font-size: 1.2em;
      margin-bottom: 0.5em;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: white;
      margin: 0.3em 0;
      padding: 0.5em;
      border-radius: 5px;
      cursor: pointer;
    }
    li.completed {
      text-decoration: line-through;
      background: #d0e6e0;
      color: gray;
    }
    .timer {
      background: white;
      padding: 1em;
      border-radius: 10px;
      margin-top: 2em;
      text-align: center;
    }
    #time {
      font-size: 2em;
      margin: 0.5em 0;
    }
    button {
      margin: 0.3em;
      padding: 0.5em 1em;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      background-color: #b3e5fc;
      cursor: pointer;
    }
    button:hover {
      background-color: #81d4fa;
    }
  </style>
</head>
<body>

<h2>ğŸŒ¸ ä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨</h2>
<button onclick="loadCSV()">ğŸ“¥ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰èª­ã¿è¾¼ã‚€</button>
<ul id="taskList"><li>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦èª­ã¿è¾¼ã¿</li></ul>

<div class="timer">
  <h2>â± ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼</h2>
  <div id="time">25:00</div>
  <button onclick="startTimer()">â–¶ é–‹å§‹</button>
  <button onclick="pauseTimer()">â¸ ä¸€æ™‚åœæ­¢</button>
  <button onclick="resetTimer()">ğŸ” ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<script>
  function toggleTask(el) {
    el.classList.toggle('completed');
  }

  function loadCSV() {
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQLvyBKWaSvnFKfty5hSoVnG2IFipaNRaQpayLPCBzoDt6FDAVk_FUZXx1fCD6fYpnoaX5mLwGl_ZeA/pub?gid=0&single=true&output=csv";

    fetch(SHEET_CSV_URL)
      .then(response => response.text())
      .then(text => {
        const lines = text.trim().split("\\n");
        const headers = lines[0].split(",");
        const idxTitle = headers.indexOf("ã‚¿ã‚¤ãƒˆãƒ«");
        const idxDone = headers.indexOf("å®Œäº†");
        const idxType = headers.indexOf("ã‚¿ã‚¤ãƒ—");

        if (idxTitle === -1 || idxDone === -1 || idxType === -1) {
          throw new Error("ãƒ˜ãƒƒãƒ€ãƒ¼ã«å¿…è¦ãªåˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»å®Œäº†ãƒ»ã‚¿ã‚¤ãƒ—ï¼‰");
        }

        const taskList = document.getElementById("taskList");
        taskList.innerHTML = "";

        lines.slice(1).forEach(line => {
          const cols = line.split(",");
          if (cols[idxType]?.trim() !== "ã‚¿ã‚¹ã‚¯") return;

          const li = document.createElement("li");
          li.textContent = cols[idxTitle];
          if (cols[idxDone] === "1") li.classList.add("completed");
          li.onclick = () => toggleTask(li);
          taskList.appendChild(li);
        });
      })
      .catch(error => {
        document.getElementById("taskList").innerHTML = `<li>èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}</li>`;
        console.error("CSVèª­ã¿è¾¼ã¿å¤±æ•—:", error);
      });
  }

  // ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½
  let timer, timeLeft = 25 * 60, isRunning = false;

  function updateDisplay() {
    const m = String(Math.floor(timeLeft / 60)).padStart(2, '0');
    const s = String(timeLeft % 60).padStart(2, '0');
    document.getElementById("time").textContent = `${m}:${s}`;
  }

  function startTimer() {
    if (isRunning) return;
    isRunning = true;
    timer = setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        updateDisplay();
      } else {
        clearInterval(timer);
        isRunning = false;
        alert("ãŠã¤ã‹ã‚Œã•ã¾ã€ã‚ˆããŒã‚“ã°ã£ãŸã­â™ª");
      }
    }, 1000);
  }

  function pauseTimer() {
    clearInterval(timer);
    isRunning = false;
  }

  function resetTimer() {
    clearInterval(timer);
    isRunning = false;
    timeLeft = 25 * 60;
    updateDisplay();
  }

  updateDisplay();
</script>

</body>
</html>
